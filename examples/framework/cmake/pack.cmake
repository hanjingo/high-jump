
cmake_minimum_required(VERSION 3.19.2)

function(win_pack name version vendor desc contact exe_name)
    set(CPACK_PACKAGE_NAME "${name}" PARENT_SCOPE)
    set(CPACK_PACKAGE_VERSION "${version}" PARENT_SCOPE)
    set(CPACK_PACKAGE_VENDOR "${vendor}" PARENT_SCOPE)
    set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "${desc}" PARENT_SCOPE)
    set(CPACK_PACKAGE_CONTACT "${contact}" PARENT_SCOPE)
    set(CPACK_PACKAGE_INSTALL_DIRECTORY "${name}" PARENT_SCOPE)
    set(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_SOURCE_DIR}/LICENSE" PARENT_SCOPE)
    set(CPACK_PACKAGE_EXECUTABLES "${exe_name}" "${name} app" PARENT_SCOPE)
    set(CPACK_SOURCE_GENERATOR "TGZ;ZIP" PARENT_SCOPE)
    set(CPACK_GENERATOR "NSIS;ZIP" PARENT_SCOPE)
    set(CPACK_NSIS_DISPLAY_NAME "${name}" PARENT_SCOPE)
    set(CPACK_NSIS_PACKAGE_NAME "${name}" PARENT_SCOPE)
    set(CPACK_NSIS_CONTACT "${contact}" PARENT_SCOPE)
    set(CPACK_NSIS_MODIFY_PATH ON PARENT_SCOPE)
    # set(CPACK_NSIS_MUI_ICON "${CMAKE_SOURCE_DIR}/res/${name}.ico" PARENT_SCOPE)
    set(CPACK_NSIS_INSTALLED_ICON_NAME "bin/${exe_name}.exe" PARENT_SCOPE)
    set(CPACK_NSIS_HELP_LINK "https://github.com/hanjingo/libcpp" PARENT_SCOPE)
    set(CPACK_NSIS_URL_INFO_ABOUT "https://github.com/hanjingo/libcpp" PARENT_SCOPE)
    set(CPACK_NSIS_ENABLE_UNINSTALL_BEFORE_INSTALL ON PARENT_SCOPE)
    set(CPACK_NSIS_CREATE_ICONS_EXTRA "CreateShortCut '$DESKTOP/${name}.lnk' '$INSTDIR/bin/${exe_name}.exe'" PARENT_SCOPE)
    set(CPACK_NSIS_DELETE_ICONS_EXTRA "Delete '$DESKTOP/${name}.lnk'" PARENT_SCOPE)

    include(CPack)
endfunction()

function(mac_pack name version vendor desc contact exe_name)
    set(CPACK_PACKAGE_NAME "${name}" PARENT_SCOPE)
    set(CPACK_PACKAGE_VERSION "${version}" PARENT_SCOPE)
    set(CPACK_PACKAGE_VENDOR "${vendor}" PARENT_SCOPE)
    set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "${desc}" PARENT_SCOPE)
    set(CPACK_PACKAGE_CONTACT "${contact}" PARENT_SCOPE)
    set(CPACK_PACKAGE_INSTALL_DIRECTORY "${name}" PARENT_SCOPE)
    set(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_SOURCE_DIR}/LICENSE" PARENT_SCOPE)
    set(CPACK_PACKAGE_EXECUTABLES "${exe_name}" "${name} app" PARENT_SCOPE)
    set(CPACK_SOURCE_GENERATOR "TGZ;ZIP" PARENT_SCOPE)
    set(CPACK_GENERATOR "DragNDrop;TGZ;ZIP" PARENT_SCOPE)
    set(CPACK_DMG_BACKGROUND_IMAGE "" PARENT_SCOPE)
    set(CPACK_DMG_DS_STORE_SETUP_SCRIPT "" PARENT_SCOPE)
    set(CPACK_DMG_DISABLE_APPLICATIONS_SYMLINK ON PARENT_SCOPE)
    set(CPACK_DMG_VOLUME_NAME "${name}" PARENT_SCOPE)

    include(CPack)
endfunction()

function(linux_pack name version vendor desc contact exe_name)
    set(CPACK_PACKAGE_NAME "${name}" PARENT_SCOPE)
    set(CPACK_PACKAGE_VERSION "${version}" PARENT_SCOPE)
    set(CPACK_PACKAGE_VENDOR "${vendor}" PARENT_SCOPE)
    set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "${desc}" PARENT_SCOPE)
    set(CPACK_PACKAGE_CONTACT "${contact}" PARENT_SCOPE)
    set(CPACK_PACKAGE_INSTALL_DIRECTORY "${name}" PARENT_SCOPE)
    set(CPACK_RESOURCE_FILE_LICENSE "${CMAKE_SOURCE_DIR}/LICENSE" PARENT_SCOPE)
    set(CPACK_PACKAGE_EXECUTABLES "${exe_name}" "${name} app" PARENT_SCOPE)
    set(CPACK_SOURCE_GENERATOR "TGZ;ZIP" PARENT_SCOPE)
    find_program(LSB_RELEASE_EXEC lsb_release)
    if(LSB_RELEASE_EXEC)
        execute_process(COMMAND ${LSB_RELEASE_EXEC} -is OUTPUT_VARIABLE LSB_ID OUTPUT_STRIP_TRAILING_WHITESPACE)
        if(LSB_ID STREQUAL "Ubuntu" OR LSB_ID STREQUAL "Debian")
            set(CPACK_GENERATOR "DEB;TGZ;ZIP" PARENT_SCOPE)
        elseif(LSB_ID STREQUAL "CentOS" OR LSB_ID STREQUAL "RedHatEnterpriseServer" OR LSB_ID STREQUAL "Fedora")
            set(CPACK_GENERATOR "RPM;TGZ;ZIP" PARENT_SCOPE)
        else()
            set(CPACK_GENERATOR "TGZ;ZIP" PARENT_SCOPE)
        endif()
    else()
        set(CPACK_GENERATOR "TGZ;ZIP" PARENT_SCOPE)
    endif()
    set(CPACK_DEBIAN_PACKAGE_MAINTAINER "${contact}" PARENT_SCOPE)
    set(CPACK_DEBIAN_PACKAGE_SECTION "devel" PARENT_SCOPE)
    set(CPACK_DEBIAN_PACKAGE_DEPENDS "libc6 (>= 2.27)" PARENT_SCOPE)
    set(CPACK_RPM_PACKAGE_LICENSE "MIT" PARENT_SCOPE)
    set(CPACK_RPM_PACKAGE_GROUP "Development/Tools" PARENT_SCOPE)
    set(CPACK_RPM_PACKAGE_REQUIRES "libstdc++ >= 4.8" PARENT_SCOPE)

    include(CPack)
endfunction()